"use strict";(self.webpackChunkmodern_admin=self.webpackChunkmodern_admin||[]).push([[966],{49966:(N,d,i)=>{i.r(d),i.d(d,{BulkImportModule:()=>x});var v=i(96814),p=i(60095),u=i(12236),c=i(15861),m=i(74825),I=i(13519),h=i.n(I),T=i(10217),b=i(20553),t=i(19212),k=i(22844),S=i(65619),g=i(69862);let B=(()=>{class n extends k.s{constructor(e){super(e,"BulkImport"),this.http=e,this.uploads=new S.X(null),this.uploads$=this.uploads.asObservable()}static#t=this.\u0275fac=function(o){return new(o||n)(t.LFG(g.eN))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var y=i(12746);function Z(n,w){1&n&&(t.TgZ(0,"div",15),t._UZ(1,"img",16),t.qZA())}const U=[{path:"",component:(()=>{class n{constructor(e,o,l){this.bulkImportService=e,this.modalService=o,this.http=l,this.selectedFile=null,this.excelFiles=[],this.formData=new FormData,this.batchGuidId="",this.spinnerDuration=2e3}ngOnInit(){}onFilesSelected(e){const o=e.target.files[0];this.formData.append("file",o,o.name)}uploadExcelFiles(e){let o=document.getElementById("txtBatchGuid").value;this.formData.append("data",JSON.stringify(o)),this.bulkImportService.postUrl("add-bulkImportFiles",this.formData).subscribe(l=>{(0,m.H)(this.spinnerDuration).subscribe(()=>this.closeSpinnerModal(this.modalReference)),h().fire("Bulk Import Success","Bulk Import Successful.","success")})}getBatchID(){this.bulkImportService.postUrl("get-batch-guidid","").subscribe(e=>{e.batchId&&(this.batchGuidId=e.batchId.batchId)})}RunTempTableImportProc(){(0,m.H)(this.spinnerDuration).subscribe(()=>this.closeSpinnerModal(this.modalReference)),h().fire("Bulk Import Success","Bulk Import Successful.","success")}downloadSubjectSectorsImportTemplate(){this.urlSplit=[],this.importFileName="SubjectSectorsFile",this.getTemplateUrl({BulkImportTemplateUrl:this.importFileName})}downloadStudentImportTemplate(){this.urlSplit=[],this.importFileName="StudentsImportFile",this.getTemplateUrl({BulkImportTemplateUrl:this.importFileName})}downloadStudentTemplate(){(new Headers).append("responseType","arraybuffer"),this.bulkImportService.getUrl("download-student-template").subscribe(l=>{var r=window.URL.createObjectURL(l);window.open(r);const s=new Blob([l],{type:"application/octet-stream"});T.saveAs(s,"tmp.xlsx")})}getTemplateUrl(e){this.bulkImportService.postUrl("get-template-url",e).subscribe(o=>{this.templateUrl=o,this.startDownload(this.templateUrl)})}startDownload(e){var o=this;return(0,c.Z)(function*(){o.setTemplateFileNames(o.importFileName),o.DocumentsDownload(e).subscribe(function(){var l=(0,c.Z)(function*(r){let s=r;const f=new Blob([s.body],{type:s.body?.type});if(""!=f.type){const a=document.createElement("a");a.setAttribute("style","display:none;"),document.body.appendChild(a),a.download=o.templateFileName.toString(),a.href=URL.createObjectURL(f),a.target="_blank",a.click(),document.body.removeChild(a)}});return function(r){return l.apply(this,arguments)}}())})()}setTemplateFileNames(e){var o=this;return(0,c.Z)(function*(){o.templateFileName="StudentsImportFile"==o.importFileName?"Students Bulk Import Template.xlsx":"Subject Sectors Bulk Import Template.xlsx"})()}setTemplateEndPoint(e){var o=this;return(0,c.Z)(function*(){console.log(JSON.stringify(e)),console.log(JSON.stringify(e).split("\\")),o.urlSplit=JSON.stringify(e).split("\\"),e=JSON.stringify(e),console.log(e.toString)})()}DocumentsDownload(e){return this.setTemplateEndPoint(e),-1==this.urlSplit.lastIndexOf('SubjectSectorsBulkImport.xlsx"}')?(console.log("download-student-template"),this.http.get(`${b.N.apiUrl}api/BulkImport/download-student-template`,{reportProgress:!0,observe:"events",responseType:"blob"})):(console.log("download-subjectsectors-template"),this.http.get(`${b.N.apiUrl}api/BulkImport/download-subjectsectors-template`,{reportProgress:!0,observe:"events",responseType:"blob"}))}open(e){this.modalReference=this.modalService.open(e),this.modalReference.result.then(o=>{this.closeResult=`Closed with: ${o}`},()=>{this.closeResult="Dismissed "})}closeSpinnerModal(e){e.dismiss()}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(B),t.Y36(y.FF),t.Y36(g.eN))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-bulk-import"]],decls:60,vars:3,consts:[[1,"app-content","content"],["id","divQRCodeInstructions","readonly","true",2,"width","100%"],[1,"col-lg-12"],[1,"row"],[1,"col-lg-6"],[1,"col-md-4"],["name","file","type","file","id","flUpload","accept",".xls,.xlsx,",3,"change"],["id","studentTemplate",2,"border-color","#0d93e9 !important",";\n                    text-decoration","underline","text-decoration-color","#0d93e9","text-align","center","display","inline-block","font-size","12px",3,"click"],["id","subjectSectorsTemplate",2,"border-color","#0d93e9 !important",";\n                     text-decoration","underline","text-decoration-color","#0d93e9","text-align","center","display","inline-block","font-size","12px",3,"click"],["type","submit","value","Upload","name","UploadButton","id","UploadButton",3,"click"],[2,"display","none"],["type","text","id","txtBatchGuid","name","txtBatchGuid","placeholder","Batch ID","maxlength","5",1,"form-control",3,"value"],["type","button","id","btnGetBatchID",1,"btn","btn-info","btn-min-width","mr-1","mb-1",3,"click"],["type","button","id","btnRunProc",1,"btn","btn-info","btn-min-width","mr-1","mb-1",3,"click"],["spinnerLoaderModalStudent",""],["id","loader",2,"z-index","99999","height","100%","width","100%","background","transparent","position","fixed"],["src","../../../../assets/images/loaderBlueTrans.gif","id","bg","alt","",2,"top","0","left","0","position","absolute","margin","auto","right","0","bottom","0","display","block"]],template:function(o,l){1&o&&(t.TgZ(0,"div",0),t._UZ(1,"br")(2,"br")(3,"br"),t.TgZ(4,"div",1)(5,"div",2)(6,"div",3)(7,"div",4),t._uU(8," Instructions "),t._UZ(9,"br"),t.TgZ(10,"ul")(11,"li"),t._uU(12," Upload the 2 files from the center. "),t.qZA(),t.TgZ(13,"li"),t._uU(14," Click Get batch ID button and Batch ID textbox must be populated. "),t.qZA(),t.TgZ(15,"li"),t._uU(16," Click Run Proc button. "),t.qZA()()()()()(),t._UZ(17,"br")(18,"br")(19,"br"),t.TgZ(20,"div",3)(21,"div",5)(22,"div")(23,"label"),t._uU(24,"Bulk Upload 1"),t.qZA(),t.TgZ(25,"input",6),t.NdJ("change",function(s){return l.onFilesSelected(s)}),t.qZA()(),t.TgZ(26,"div"),t._UZ(27,"br"),t.TgZ(28,"a",7),t.NdJ("click",function(){return l.downloadStudentImportTemplate()}),t._uU(29,"Students Details File"),t.qZA()()(),t.TgZ(30,"div",5)(31,"div")(32,"label"),t._uU(33,"Bulk Upload 2"),t.qZA(),t.TgZ(34,"input",6),t.NdJ("change",function(s){return l.onFilesSelected(s)}),t.qZA()(),t.TgZ(35,"div"),t._UZ(36,"br"),t.TgZ(37,"a",8),t.NdJ("click",function(){return l.downloadSubjectSectorsImportTemplate()}),t._uU(38,"Grade and Subjects File"),t.qZA()()(),t.TgZ(39,"div",5)(40,"div")(41,"input",9),t.NdJ("click",function(s){return l.uploadExcelFiles(s)}),t.qZA()()()(),t._UZ(42,"br")(43,"br")(44,"br"),t.TgZ(45,"div",3)(46,"div",5)(47,"div"),t._UZ(48,"label",10)(49,"input",11),t.qZA()(),t.TgZ(50,"div",5)(51,"div"),t._UZ(52,"label",10),t.TgZ(53,"button",12),t.NdJ("click",function(){return l.getBatchID()}),t._uU(54,"Get ID"),t.qZA()()(),t.TgZ(55,"div",5)(56,"button",13),t.NdJ("click",function(){return l.RunTempTableImportProc()}),t._uU(57,"Run Proc"),t.qZA()()()(),t.YNc(58,Z,2,0,"ng-template",null,14,t.W1O)),2&o&&(t.xp6(49),t.Q6J("value",l.batchGuidId),t.xp6(7),t.ekj("run-proc",""===l.batchGuidId))},styles:[".run-proc[_ngcontent-%COMP%]{display:none}a[_ngcontent-%COMP%]:link, a[_ngcontent-%COMP%]:visited{border-color:#0d93e9!important;background-color:#0d93e9!important;text-decoration:underline;text-decoration-color:#0d93e9;padding:14px 25px;text-align:center;display:inline-block}a[_ngcontent-%COMP%]:hover, a[_ngcontent-%COMP%]:active{text-decoration-color:#0d8bdd}"]})}return n})()}];let F=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(U),u.Bz]})}return n})(),x=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[v.ez,p.u5,p.UX,F]})}return n})()}}]);