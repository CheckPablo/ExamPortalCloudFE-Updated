"use strict";(self.webpackChunkmodern_admin=self.webpackChunkmodern_admin||[]).push([[983],{30912:(S,v,l)=>{l.d(v,{e:()=>C,q:()=>_});var f=l(19212);const b={asc:"desc",desc:"","":"asc"},_=(o,c)=>o<c?-1:o>c?1:0;let C=(()=>{class o{constructor(){this.sortable="",this.direction="",this.sort=new f.vpe}rotate(){this.direction=b[this.direction],this.sort.emit({column:this.sortable,direction:this.direction})}static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275dir=f.lG2({type:o,selectors:[["th","sortable",""]],hostVars:4,hostBindings:function(a,h){1&a&&f.NdJ("click",function(){return h.rotate()}),2&a&&f.ekj("asc","asc"===h.direction)("desc","desc"===h.direction)},inputs:{sortable:"sortable",direction:"direction"},outputs:{sort:"sort"}})}return o})()},1026:(S,v,l)=>{l.d(v,{N:()=>b});var f=l(19212);let b=(()=>{class _{constructor(){this.startIndex=0,this.endIndex=0,this.paginationLinks=[],this.totalPages=1,this.searchTotal=0,this.currentPage=1,this.pageSize=10,this.totalItems=0,this.sortConfig={key:"",direction:"asc"},this.searchTerm="",this.sourceData=[]}generatePaginationLinks(){const c=Math.ceil(this.searchTotal/this.pageSize),g=this.currentPage;let a=1,h=c<=10?c:10;c>10&&(g<=6?h=10:g+4>=c?(a=c-9,h=c):(a=g-5,h=g+4)),this.paginationLinks=Array.from({length:h-a+1},(T,m)=>a+m)}goToNextPage(){this.currentPage<this.totalPages&&this.setPage(this.currentPage+1)}goToPreviousPage(){this.currentPage>1&&this.setPage(this.currentPage-1)}onSearchInputChange(o){this.setSearchQuery(o),this.filterData(this.sourceData),this.setPage(1),this.paginate()}setPage(o){this.currentPage=o,this.paginate()}setPageSize(o){this.pageSize=o,this.setPage(1),this.paginate()}setSortConfig(o,c){this.sortConfig.key=o,this.sortConfig.direction=c}setSearchQuery(o){this.searchTerm=o}setData(o){this.sourceData=o,this.updateTotalItems(),this.paginate()}toggleSortDirection(){this.sortConfig.direction="asc"===this.sortConfig.direction?"desc":"asc"}filterData(o){if(!this.searchTerm)return this.searchedData=o,this.searchTotal=o.length,o;const c=this.searchTerm.toLowerCase();return this.searchedData=o.filter(g=>Object.values(g).some(a=>a?.toString()?.toLowerCase()?.includes(c))),this.searchTotal=this.searchedData.length,this.searchedData}sortData(o){const{key:c,direction:g}=this.sortConfig;return c?o.sort((a,h)=>{const T=a[c],m=h[c];return T<m?"asc"===g?-1:1:T>m?"asc"===g?1:-1:0}):o}updateTotalItems(){const o=this.filterData(this.sourceData);this.totalItems=o.length}paginate(){const o=this.filterData(this.sourceData),c=this.sortData(o),g=(this.currentPage-1)*this.pageSize;this.totalPages=Math.ceil(o.length/this.pageSize),this.startIndex=g+1,this.endIndex=Math.min(g+this.pageSize,c.length),this.paginatedData=c.slice(g,this.endIndex),this.generatePaginationLinks()}static#t=this.\u0275fac=function(c){return new(c||_)};static#e=this.\u0275prov=f.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},3017:(S,v,l)=>{l.d(v,{q:()=>C});var f=l(22844),b=l(19212),_=l(69862);let C=(()=>{class o extends f.s{constructor(g){super(g,"Tests"),this.http=g,this.search=a=>this.postUrl(`search-tests?gradeId=${a.gradeId??""}&subjectId=${a.subjectId??""}&testType=${a.testType??""}&fromDate=${a.fromDate??""}&endDate=${a.endDate??""}`,a),this.searchTestOTP=a=>this.postUrl(`search-testsOTP?centerId=${a.centerId??""}&gradeId=${a.gradeId??""}&subjectId=${a.subjectId??""}&testId=${a.testId??""}`,a),this.offlineTest=a=>this.postUrl("convert-offlinestring",a),this.linkInvigilator=(a,h)=>this.postEndpoint("link-students",{userId:a,studentIds:h}),this.createNewOTP=(a,h,T,m,t)=>this.postEndpoint("create-newOTP",{code:a,testId:h,centerId:T,gradeId:m,subjectId:t}),this.sendOTP=a=>this.postUrl(`${a}/send-otp-toStudents`,a),this.sendLoginCredentials=a=>this.postUrl("send-login-credentials",a),this.getByTestId=a=>this.getUrl(`get-by-testId/${a}`),this.getOTPTest=(a,h)=>this.getUrl(`getTestBySubject/${a}/${h}`)}static#t=this.\u0275fac=function(a){return new(a||o)(b.LFG(_.eN))};static#e=this.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},1983:(S,v,l)=>{l.r(v),l.d(v,{LiveTestMonitoringModule:()=>ct});var f=l(96814),b=l(20553),_=l(12236),C=l(15861),o=l(60095),c=l(30912),g=l(5178),a=l(13519),h=l.n(a),T=l(22339),m=l(85289),t=l(19212),Z=l(17972),L=l(13602),P=l(1026),F=l(88350),N=l(32008),O=l(3017),w=l(12746),j=l(72547),A=l(3193);const J=["monitoringChatModal"],q=["sendBulkOTPModal"];function E(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"div",38)(1,"div",39)(2,"button",40),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onSendOTPClicked())}),t._uU(3," Send OTP "),t.qZA(),t.TgZ(4,"button",41),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onBulkSendClicked())}),t._uU(5," Send Bulk Message (Test) "),t.qZA(),t.TgZ(6,"button",42),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(),r=t.MAs(62);return t.KtG(s.openExtraTimeModal(r))}),t._uU(7," Add Extra Time "),t.qZA()()()}}function G(i,u){if(1&i&&(t.TgZ(0,"option",43),t._uU(1),t.qZA()),2&i){const e=u.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.code,"")}}function B(i,u){if(1&i&&(t.TgZ(0,"option",43),t._uU(1),t.qZA()),2&i){const e=u.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.description,"")}}function Q(i,u){1&i&&(t.TgZ(0,"div"),t._uU(1,"Subject is required "),t.qZA())}function $(i,u){if(1&i&&(t.TgZ(0,"div",44),t.YNc(1,Q,2,0,"div",45),t.qZA()),2&i){const e=t.oxw();t.xp6(),t.Q6J("ngIf",e.f.subjectId.errors.required)}}function H(i,u){if(1&i&&(t.TgZ(0,"option",43),t._uU(1),t.qZA()),2&i){const e=u.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.testName,"")}}function Y(i,u){1&i&&(t.TgZ(0,"h4"),t.O4$(),t.TgZ(1,"svg",54),t._UZ(2,"path",55)(3,"path",56),t.qZA(),t.kcU(),t.TgZ(4,"span"),t._uU(5,"extra-time"),t.qZA()())}function K(i,u){1&i&&(t.TgZ(0,"h6",50),t._uU(1,"Test has been completed"),t.qZA())}function R(i,u){1&i&&(t.TgZ(0,"h6",50),t._uU(1,"Test not yet started "),t.qZA())}function V(i,u){if(1&i&&(t.TgZ(0,"h6",50),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(),t.hij("Test time started: ",t.xi3(2,1,e.startDate,"yyyy/MM/dd HH:mm:ss")," ")}}function z(i,u){1&i&&(t.TgZ(0,"h4",50),t._uU(1," Connection Status: Offline (Test Completed) "),t.qZA())}function W(i,u){if(1&i&&(t.TgZ(0,"h4",50),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(),t.hij(" User has gone offline at approx: ",t.xi3(2,1,e.lastSaved,"yyyy/MM/dd HH:mm:ss")," ")}}function X(i,u){if(1&i&&(t.TgZ(0,"h4",50),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(),t.hij(" Connection Status: Offline: ",t.xi3(2,1,e.lastSaved,"yyyy/MM/dd HH:mm:ss")," ")}}function tt(i,u){if(1&i&&(t.TgZ(0,"h4",50),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(),t.hij(" Connection Status: Online: ",t.xi3(2,1,e.lastSaved,"yyyy/MM/dd HH:mm:ss")," ")}}function et(i,u){1&i&&(t.TgZ(0,"h4",50),t._uU(1),t.qZA()),2&i&&(t.xp6(),t.hij("","Irregularity: Detected"," "))}function st(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"div",46),t.YNc(1,Y,6,0,"h4",45),t.TgZ(2,"div",47),t.NdJ("click",function(){const r=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.goToCandidateLiveMonitor(r))}),t.TgZ(3,"div",48)(4,"div",49)(5,"h4",50),t._uU(6),t.qZA(),t.TgZ(7,"h6",51),t._uU(8),t.qZA()(),t.TgZ(9,"div",52),t.YNc(10,K,2,0,"h6",53)(11,R,2,0,"h6",53)(12,V,3,4,"h6",53)(13,z,2,0,"h4",53)(14,W,3,4,"h4",53)(15,X,3,4,"h4",53)(16,tt,3,4,"h4",53)(17,et,2,1,"h4",53),t.qZA()()()()}if(2&i){const e=u.$implicit;t.xp6(),t.Q6J("ngIf","00:00:00"!=e.studentExtraTime),t.xp6(),t.ekj("yellow",e.startDate&&e.isIrregularity)("pink",!e.offline&&e.startDate&&e.offline2>=5),t.xp6(4),t.AsE(" ",e.name," ",e.surname," "),t.xp6(2),t.hij(" ",e.testName," "),t.xp6(2),t.Q6J("ngIf",e.endDate),t.xp6(),t.Q6J("ngIf",!e.startDate),t.xp6(),t.Q6J("ngIf",e.startDate&&!e.endDate),t.xp6(),t.Q6J("ngIf",e.endDate),t.xp6(),t.Q6J("ngIf",!e.offline&&e.startDate&&e.offline2>=5),t.xp6(),t.Q6J("ngIf",e.offline),t.xp6(),t.Q6J("ngIf",!e.offline&&e.startDate&&e.offline2<5),t.xp6(),t.Q6J("ngIf",e.fullScreenClosed||e.leftExamArea||e.keyPress)}}function it(i,u){if(1&i&&(t.TgZ(0,"option",43),t._uU(1),t.qZA()),2&i){const e=u.$implicit;t.Q6J("value",e.key),t.xp6(),t.hij(" ",e.value," ")}}function nt(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"input",75),t.NdJ("click",function(){const r=t.CHM(e).$implicit,d=t.oxw(2);return t.KtG(d.onStudentClick(r.studentID))}),t.qZA()(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td")(12,"select",76),t.NdJ("change",function(s){const d=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.onChangeExtraTime(s,d.studentId))}),t.TgZ(13,"option",16),t._uU(14,"--Select Extra--"),t.qZA(),t.YNc(15,it,2,2,"option",17),t.qZA()()()}if(2&i){const e=u.$implicit,n=t.oxw(2);t.xp6(2),t.Q6J("value",e.studentID)("checked",n.isStudentSelected(e.studentID)),t.xp6(2),t.hij(" ",e.surname," "),t.xp6(2),t.hij(" ",e.name," "),t.xp6(2),t.hij(" ",e.examN," "),t.xp6(2),t.hij(" ",e.idNumber," "),t.xp6(2),t.Q6J("name",e.studentID)("value",0),t.xp6(3),t.Q6J("ngForOf",n.extraTimeDurations)}}function ot(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"div",57)(1,"h4",58),t._uU(2,"Extra Time"),t.qZA(),t.TgZ(3,"button",59),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Cross click"))}),t.qZA()(),t.TgZ(4,"form",60),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onExtraTimeSubmit())}),t.TgZ(5,"div",61)(6,"div",11),t._UZ(7,"input",62),t.qZA(),t.TgZ(8,"div",63)(9,"button",64),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onExtraTimeClick())}),t._UZ(10,"i",65),t._uU(11," Add Time "),t.qZA(),t._UZ(12,"br")(13,"br"),t.TgZ(14,"input",66),t.NdJ("change",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onSelectAll())}),t.qZA(),t.TgZ(15,"label",67),t._uU(16," Select All"),t.qZA(),t.TgZ(17,"div",68)(18,"table",69)(19,"thead",70)(20,"tr")(21,"th",71),t._uU(22,"StudentID"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Link"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Surname"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Fore Names"),t.qZA(),t.TgZ(29,"th"),t._uU(30,"Exam Number"),t.qZA(),t.TgZ(31,"th"),t._uU(32,"ID Number"),t.qZA(),t.TgZ(33,"th"),t._uU(34,"Extra Time (Minutes)"),t.qZA()()(),t.TgZ(35,"tbody"),t.YNc(36,nt,16,9,"tr",72),t.qZA()()()()(),t.TgZ(37,"div",73)(38,"button",74),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Close modal"))}),t._uU(39," Close "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(4),t.Q6J("formGroup",e.extraTimeForm),t.xp6(5),t.Q6J("disabled",!e.studentIds.length),t.xp6(5),t.Q6J("checked",e.isAllSelected),t.xp6(22),t.Q6J("ngForOf",e.links)}}function rt(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"div",57),t._UZ(1,"h4",58),t.TgZ(2,"button",59),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Cross click"))}),t.qZA()(),t.TgZ(3,"form",60),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onInvigilatorBulkMessageSend())}),t.TgZ(4,"div",61)(5,"div",11),t._UZ(6,"input",77),t.qZA(),t.TgZ(7,"div",11)(8,"div",78),t._uU(9," Bulk Message "),t.TgZ(10,"div",79)(11,"div"),t._UZ(12,"br"),t.TgZ(13,"div",80)(14,"textarea",81),t._uU(15),t.qZA()()()(),t.TgZ(16,"div",79)(17,"div",82),t._UZ(18,"input",83),t.qZA()()()()(),t.TgZ(19,"div",73)(20,"button",74),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Close modal"))}),t._uU(21," Close "),t.qZA(),t.TgZ(22,"button",84),t._uU(23," Send "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.bulkMessagingForm),t.xp6(12),t.hij("    ",e.bulkMessages,"\n")}}function at(i,u){if(1&i){const e=t.EpF();t.TgZ(0,"div",57),t._UZ(1,"h4",58),t.TgZ(2,"button",59),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Cross click"))}),t.qZA()(),t.TgZ(3,"form",60),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onOTPBulkSend())}),t.TgZ(4,"div",61)(5,"div",11),t._UZ(6,"input",77),t.qZA(),t.TgZ(7,"div",11)(8,"div",78),t._uU(9," One Time Pin "),t.TgZ(10,"div",79)(11,"div",82),t._UZ(12,"input",85),t.qZA()()()()(),t.TgZ(13,"div",73)(14,"button",74),t.NdJ("click",function(){const r=t.CHM(e).dismiss;return t.KtG(r("Close modal"))}),t._uU(15," Close "),t.qZA(),t.TgZ(16,"button",84),t._uU(17," Send "),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.otpMessagingForm)}}const k=i=>({"is-invalid":i}),dt=[{path:"",component:(()=>{class i{constructor(e,n,s,r,d,p,I,ut,ht,gt,mt,pt){this.db=e,this.centerService=n,this.cdRef=s,this.gradeService=r,this.paginationService=d,this.router=p,this.subjectService=I,this.liveMonitoringService=ut,this.testService=ht,this.formBuilder=gt,this.modalService=mt,this.authService=pt,this.baseSubjects=[],this.extraTimes={},this.grades=[],this.submitted=!1,this.itemsPerPage=10,this.centers=[],this.testChatMessageArea=new o.NI(""),this.candidateSearchType=1,this.studentList=[],this.links=[],this.studentIds=[],this.accomodationIds=[],this.readerIds=[],this.extraTimeIds={},this.isAllSelected=!1,this.extraTimeDurations=[],this.studentsChatlist=[],this.bulkMessagelist=[],this.otpToValidate=new o.NI(""),this.onload=!0,this.duration=50,this.generateExtraTimeDurations=()=>{for(let x=10;x<=45;x+=10){const _t=x%60,D=Math.floor(x/60).toString().padStart(2,"0"),U=_t.toString().padStart(2,"0");this.extraTimeDurations.push({key:`${D}:${U}:00`,value:`${D} hrs : ${U} min`})}},this.onChangeTest=M=>{this.selectedTestId=M,this.save()},this.getSubjects=()=>{this.subjectService.getByGradeId(this.selectedGrade).subscribe(M=>{this.subjects=M;const x={...this.searchForm.value,subjectId:0,testId:"0"};this.searchForm.setValue(x)})},this.resetLinks=()=>{this.studentIds=[],this.accomodationIds=[],this.readerIds=[],this.extraTimeIds=[]},this.startTimer(1e3),setTimeout(()=>{this.stopTimer()},3e4)}ngOnInit(){this.paginationService.setData([]),this.getUser(),this.onRedirect()||(this.getGrades(),this.getCenters()),this.otpToValidate.valueChanges.subscribe(()=>{}),this.initForms(),this.initOTPForms(),this.initBulkMessageForms(),this.selectedGrade=0,this.selectedSubject=0,this.user=JSON.parse(localStorage.getItem("user")),this.generateExtraTimeDurations()}get f(){return this.searchForm.controls}get b(){return this.bulkMessagingForm.controls}get o(){return this.otpMessagingForm.controls}firstFunction(){}getCenters(){this.centerService.get().subscribe(e=>{this.centers=e,this.clearTable()})}getGrades(){l(16676),this.gradeService.get().subscribe(n=>{this.grades=n,this.clearTable(),this.paginationService.onSearchInputChange("")})}isStudentSelected(e){return this.studentIds.some(n=>n===e)}onChangeSubject(e){this.selectedSubject=e,document.getElementById("subjectId"),this.testService.getOTPTest(this.searchForm.value.gradeId,e).subscribe(s=>{this.tests=s,this.clearTable(),this.save();const r={...this.searchForm.value,subjectId:e,testId:"0"};this.searchForm.setValue(r)}),this.logLocalVariables()}onGradeChange(e){this.subjectService.getByGradeId(e).subscribe(n=>{this.subjects=n,this.baseSubjects=n,this.tests=[],this.selectedGrade=e;const s={...this.searchForm.value,gradeId:e,subjectId:"0",testId:"0"};this.searchForm.setValue(s),this.clearTable(),this.save()}),this.logLocalVariables()}getTests(e,n){this.tests=[],this.testService.getOTPTest(e,n).subscribe(s=>{this.tests=s;const r={...this.searchForm.value,testId:"0"};this.searchForm.setValue(r)})}getUser(){this.user=this.authService.currentUserValue()}logLocalVariables(){const e=localStorage.getItem("monitorGradeId");null!==e&&this.f.gradeId.get("gradeId").setValue(Number(e));const n=localStorage.getItem("monitorSubjectId");null!==n&&this.f.subjectId.get("subjectId").setValue(Number(n));const s=localStorage.getItem("monitorTestId");null!==s&&this.f.testId.get("testId").setValue(Number(s))}initForms(){this.searchForm=this.formBuilder.group(this.form?{gradeId:[this.form.gradeId??"0",[o.kI.required]],subjectId:[this.form.subjectId??"0",[o.kI.required]],testId:[this.form.testId??"0",[o.kI.required]],candidateSearchType:[this.form.candidateSearchType??"",[]],name:[this.form.name??"",[]]}:{gradeId:[this.selectedGrade??"0",[o.kI.required]],subjectId:[this.selectedSubject??"0",[o.kI.required]],testId:[this.selectedTestId??"0",[o.kI.required]],candidateSearchType:[this.candidateSearchType??"",[]],name:[this.name??"",[]]}),this.form&&this.onSubmit(),this.submitted=!1}initOTPForms(){this.otpMessagingForm=this.formBuilder.group({otpMessage:["",[o.kI.required]]}),this.submitted=!1}initBulkMessageForms(){this.bulkMessagingForm=this.formBuilder.group({bulkMessage:["",[o.kI.required]]}),this.submitted=!1}initExtraTimeForms(){this.studentTestExtraTimeLinker.testId=this.testId,this.studentTestExtraTimeLinker.studentIds=this.studentIds,this.studentTestExtraTimeLinker.testId=this.testId,this.extraTimeForm=this.formBuilder.group({}),this.submitted=!1}onBulkSendClicked(){this.getDocs(),this.openSm(this.content)}onChangeExtraTime(e){this.extraTimes[e.target.name]=e.target.value}getDocs(){var e=this;return(0,C.Z)(function*(){const n=(0,m.hJ)(e.db,"CloudBroadcastMessaging");console.log(e.searchForm.value.testID),console.log(e.testId),console.log(e.f.testId.value);const s=(0,m.IO)(n,(0,m.ar)("studentID","==",0),(0,m.ar)("testID","==",Number(e.f.testId.value)),(0,m.Xo)("createdAt","asc"));(yield(0,m.PL)(s)).forEach(d=>{let p=new T.e;p.name=d.data().name,p.message=d.data().message,p.fromStudent=d.data().fromStudent,p.fromTeacher=d.data().fromTeacher,p.testID=d.data().testID,p.id=d.data().studentID,p.teacherReadStatus=d.data().teacherReadStatus,p.studentReadStatus=d.data().studentReadStatus,p.studentID=d.data().studentID,console.log(JSON.stringify(p)),e.bulkMessagelist.push(p)}),e.bulkMessages=e.bulkMessagelist.map(d=>`${d.name}:${d.message}`).join("\n"),console.log(e.bulkMessages)})()}onExtraTimeSubmit(){}onExtraTimeClick(){let e={testId:this.searchForm.value.testId,studentIds:this.studentIds,extraTimeIds:{...this.extraTimeIds}};const n=[];for(let s of this.studentIds)this.extraTimes[s]&&n.push(this.extraTimes[s]);0==n.length&&h().fire("No exra time has been Added","Please select an Extra time for atleast one student","error"),e.extraTimeIds=n,this.liveMonitoringService.postUrl("add-extraTime",e).subscribe(s=>{if(s.length>0){const r=s.filter(I=>I==this.links),d=[];for(const I in r)d.push(`${I.name} ${I.surname}\n`);let p=`The following students times were not because they not allowed to write the test.\n ${d.join("")}`;h().fire("Add Extra Time Success",p,"error")}else h().fire("Add Extra Time Success","extra time was successfully added","success")})}onInvigilatorBulkMessageSend(s){console.log(this.selectedTestId),console.log(this.f.testId.value),document.getElementById("testChatMessageArea").append(this.user.firstName+":"+this.b.bulkMessage.value),this.textToSend=this.b.bulkMessage.value,this.b.bulkMessage.setValue(""),s={testID:Number(this.f.testId.value),id:0,studentID:0,name:this.user.fullName,message:this.textToSend,otpMessage:"0",fromStudent:"0",fromTeacher:"1",studentReadStatus:"Unread",teacherReadStatus:"Read",createdAt:(0,m.Bt)()};const r=(0,m.hJ)(this.db,"CloudBroadcastMessaging");(0,m.ET)(r,s).then(()=>{}).catch(()=>{})}onOTPBulkSend(){var e;this.textToSend=this.o.otpMessage.value,this.o.otpMessage.setValue(""),e={testID:Number(this.searchForm.value.testId),id:0,studentID:0,name:this.user.fullName,message:this.textToSend,otpMessage:"1",fromStudent:"0",fromTeacher:"1",studentReadStatus:"Unread",teacherReadStatus:"Read",createdAt:(0,m.Bt)()};const n=(0,m.hJ)(this.db,"CloudMessagingStagePortal");(0,m.ET)(n,e).then(()=>{}).catch(()=>{})}openSm(e){this.modalService.open(e,g.U.lg)}onSelectAll(){this.isAllSelected=!this.isAllSelected,this.studentIds=[],this.isAllSelected&&(this.studentIds=this.links.map((e,n)=>e.studentID))}onStudentClick(e){this.studentIds.find(n=>n==e)?this.studentIds=this.studentIds.filter(n=>n!=e):this.studentIds.push(e)}onSubmit(){if("0"==this.searchForm.value.gradeId||null==this.searchForm.value.gradeId){if(this.onload)return;return this.title="Error",this.message="Please select grade",void(this.showModal=!0)}if("0"==this.searchForm.value.subjectId||null==this.searchForm.value.subjectId||""==this.searchForm.value.subjectId){if(this.onload)return;return this.title="Error",this.message="Please select subject",void(this.showModal=!0)}if("0"==this.searchForm.value.testId||null==this.searchForm.value.testId||""==this.searchForm.value.testId){if(this.onload)return;return this.title="Error",this.message="Please select test",void(this.showModal=!0)}this.searchForm.invalid||(this.submitted=!0,this.liveMonitoringService.search(this.searchForm.value).subscribe(e=>{this.liveMonitoringCanidateList=e,this.removeDuplicates(),this.paginationService.setData(e),this.toggleChatButtons()}))}openExtraTimeModal(e){this.populateStudentMonitoringList(this.f.gradeId.value,0,this.f.testId.value),this.modalService.open(e,g.U.lg)}populateStudentMonitoringList(e,n,s){this.testService.getUrl(`student-list?sectorId=${e}&centerId=${n}&testId=${s}`).subscribe(r=>{this.links=r,this.resetLinks(),this.paginationService.setData(r),this.studentList=r,this.cdRef.detectChanges(),r.forEach(d=>{d.linked&&this.studentIds.push(d.studentID),d.accomodation&&this.accomodationIds.push(d.studentID),d.electronicReader&&this.readerIds.push(d.studentID),this.extraTimeIds[d.studentID]=d.studentExtraTime??"00:00:00"}),this.initExtraTimeForms()})}goToCandidateLiveMonitor(e){e.selectedStudentTileClick=e.studentID,this.selectedStudentTileClick=e.studentID,this.save(),e.studentID=e.studentID,this.stingify("student",e),this.router.navigate(["/portal/candidate-live-monitoring"],{queryParams:{...e}})}saveSelectedValues(){this.stingify("form",this.searchForm.value)}stingify(e,n){localStorage.setItem(e,JSON.stringify(n))}parse(e){return JSON.parse(localStorage.getItem(e))}onRedirect(){if(this.parse("form")){const{studentIds:e,accomodationIds:n,readerIds:s,extraTimeIds:r}=this.parse("form");return this.studentIds=e,this.accomodationIds=n,this.readerIds=s,this.extraTimeIds=r,this.grades=this.parse("grades"),this.centers=this.parse("centers"),this.tests=this.parse("tests"),this.subjects=this.parse("subjects"),this.form=this.parse("form"),this.paginationService.onSearchInputChange(""),!0}return!1}onSendOTPClicked(){this.openSm(this.otpContent)}toggleChatButtons(){this.show=!this.show}clearTable(){this.liveMonitoringCanidateList=[]}save(){const e={studentIds:this.studentIds,accomodationIds:this.accomodationIds,readerIds:this.readerIds,extraTimeIds:this.extraTimeIds};localStorage.removeItem("extras"),localStorage.removeItem("grades"),localStorage.removeItem("centers"),localStorage.removeItem("tests"),localStorage.removeItem("subjects"),localStorage.removeItem("form"),this.stingify("extras",e),this.stingify("grades",this.grades),this.stingify("centers",this.centers),this.stingify("tests",this.tests),this.stingify("subjects",this.subjects),this.stingify("form",this.searchForm.value),this.onload=!1}removeDuplicates(){const e={};let n=0;for(const s of this.liveMonitoringCanidateList){if(e.hasOwnProperty(s.studentID)){console.log(s.studentID);const r=e[s.studentID];console.log("lastSaved",s.studentID.lastSaved),s.startDate?(this.liveMonitoringCanidateList.splice(r,1),console.log("index",r)):(this.liveMonitoringCanidateList.splice(n,1),console.log("x",n))}else e[s.studentID]=n;n++}}stopTimer(){this.timer&&(clearInterval(this.timer),window.location.reload())}startTimer(e){this.timer=setInterval(()=>{--this.duration},e)}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(m.gg),t.Y36(Z.F),t.Y36(t.sBO),t.Y36(L.P),t.Y36(P.N),t.Y36(_.F0),t.Y36(F._),t.Y36(N.l),t.Y36(O.q),t.Y36(o.QS),t.Y36(w.FF),t.Y36(j.e))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-live-test-monitoring"]],viewQuery:function(n,s){if(1&n&&(t.Gf(J,7),t.Gf(q,7),t.Gf(c.e,5)),2&n){let r;t.iGM(r=t.CRH())&&(s.content=r.first),t.iGM(r=t.CRH())&&(s.otpContent=r.first),t.iGM(r=t.CRH())&&(s.headers=r)}},decls:68,vars:20,consts:[[1,"content-header","row"],[1,"content-header-left","col-md-6","col-12","mb-2"],[1,"form-section"],[1,"la","la-eye"],["class","content-header-right col-md-6 col-12",4,"ngIf"],[1,"content-body"],[1,"users-list-wrapper"],[1,"users-list-filter","px-1"],[1,"row","card"],[1,"form","form-horizontal",3,"formGroup","ngSubmit"],[1,"form-body"],[1,"row"],[1,"col-md-4"],["for","ddlCenters"],[1,"form-group"],["id","gradeId","name","gradeId","formControlName","gradeId",1,"form-control","form-select",3,"ngClass","change"],["value","0","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","ddlUsers"],["id","subjectId","name","subjectId","formControlName","subjectId",1,"form-control","form-select",3,"ngClass","change"],["value","0"],["class","invalid-feedback",4,"ngIf"],["id","testId","name","testId","formControlName","testId",1,"form-control","form-select",3,"ngClass","change"],["for","candidateSearchType"],["id","candidateSearchType","formControlName","candidateSearchType",1,"form-control","form-select"],["value","1"],["value","2"],["for","name","data-toggle","tooltip","title","Name",1,"control-label"],["type","text","id","name","name","name","formControlName","name",1,"form-control"],[1,"col-4"],[1,"control-label"],["id","btnLink",1,"btn","btn-block","btn-primary","glow",3,"disabled"],[1,"irregularity-container"],["class","float-left",4,"ngFor","ngForOf"],["addExtraTimeModal",""],["monitoringChatModal",""],["sendBulkOTPModal",""],[3,"content","title","show"],[1,"content-header-right","col-md-6","col-12"],["role","group","aria-label","Button group with nested dropdown",1,"btn-group","float-md-right"],["type","button","id","btnNew",1,"btn","btn-info","btn-min-width","mr-1","mb-1",3,"click"],["type","button","id","btnSend",1,"btn","btn-info","btn-min-width","mr-1","mb-1",3,"click"],["type","button","type","button","id","addExtraTime",1,"btn","btn-info","btn-min-width","mr-1","mb-1",3,"click"],[3,"value"],[1,"invalid-feedback"],[4,"ngIf"],[1,"float-left"],[1,"card","border-blue",3,"click"],[1,"text-center","text-dark"],[1,"card-body"],[1,"card-title"],[1,"card-subtitle","text-muted"],[1,"text-center"],["class","card-title",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","primaryColor","viewBox","0 0 16 16",1,"bi","bi-stopwatch"],["d","M8.5 5.6a.5.5 0 1 0-1 0v2.9h-3a.5.5 0 0 0 0 1H8a.5.5 0 0 0 .5-.5V5.6z"],["d","M6.5 1A.5.5 0 0 1 7 .5h2a.5.5 0 0 1 0 1v.57c1.36.196 2.594.78 3.584 1.64a.715.715 0 0 1 .012-.013l.354-.354-.354-.353a.5.5 0 0 1 .707-.708l1.414 1.415a.5.5 0 1 1-.707.707l-.353-.354-.354.354a.512.512 0 0 1-.013.012A7 7 0 1 1 7 2.071V1.5a.5.5 0 0 1-.5-.5zM8 3a6 6 0 1 0 .001 12A6 6 0 0 0 8 3z"],[1,"modal-header"],["id","myModalLabel1",1,"modal-title"],["type","button","aria-hidden","true",1,"btn-close",3,"click"],[3,"formGroup","ngSubmit"],[1,"modal-body"],["type","hidden","id","CenterID",1,"form-control"],["id","tab3","aria-labelledby","base-tab3",1,"tab-pane"],["id","btnLinkTest",1,"btn","btn-info",3,"disabled","click"],[1,"la","la-check-square-o"],["type","checkbox","id","cbxCheckAll","name","cbxCheckAll","value","SelectAll",3,"checked","change"],["for","cbxCheckAll"],[1,"table-responsive",2,"width","100%"],["id","StudentListTable",2,"width","100%"],[1,"bg-info","white"],[2,"display","none"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","ngbAutofocus","",1,"btn","grey","btn-outline-secondary",3,"click"],["type","checkbox","id","cbxCheckStudentLink",3,"value","checked","click"],["id","extraTimeDuration",1,"form-control",3,"name","value","change"],["type","hidden","id","TestID",1,"form-control"],[1,"col-lg-12"],[1,"form-group","row"],[1,"col-md-9","mx-auto",2,"text-align","center"],["readonly","","id","testChatMessageArea","rows","15","cols","90","wrap","hard",1,"message-text",2,"text-align","center"],[1,"col-md-9","mx-auto"],["type","text","formControlName","bulkMessage","id","bulkMessage","placeholder","Enter Message",1,"form-control"],["type","submit",1,"btn","btn-outline-primary"],["type","text","formControlName","otpMessage","id","otpMessage","placeholder","Enter Message",1,"form-control"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._UZ(3,"i",3),t._uU(4,"Search Uploaded Tests"),t.qZA()(),t.YNc(5,E,8,0,"div",4),t.TgZ(6,"div",5)(7,"section",6)(8,"div",7)(9,"div",8)(10,"form",9),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),t._uU(15,"Grade:"),t.qZA(),t.TgZ(16,"fieldset",14)(17,"select",15),t.NdJ("change",function(d){return s.onGradeChange(d.target.value)}),t.TgZ(18,"option",16),t._uU(19,"--Select Grade--"),t.qZA(),t.YNc(20,G,2,2,"option",17),t.qZA()()(),t.TgZ(21,"div",12)(22,"fieldset",14)(23,"label",18),t._uU(24,"Subject:"),t.qZA(),t.TgZ(25,"select",19),t.NdJ("change",function(d){return s.onChangeSubject(d.target.value)}),t.TgZ(26,"option",20),t._uU(27,"--Select Subject--"),t.qZA(),t.YNc(28,B,2,2,"option",17),t.qZA(),t.YNc(29,$,2,1,"div",21),t.qZA()()(),t.TgZ(30,"div",11)(31,"div",12)(32,"fieldset",14)(33,"label",18),t._uU(34,"Test:"),t.qZA(),t.TgZ(35,"select",22),t.NdJ("change",function(d){return s.onChangeTest(d.target.value)}),t.TgZ(36,"option",20),t._uU(37,"--Select Test"),t.qZA(),t.YNc(38,H,2,2,"option",17),t.qZA()()(),t.TgZ(39,"div",12)(40,"div",14)(41,"label",23),t._uU(42,"Candidate Filter:"),t.qZA(),t.TgZ(43,"select",24)(44,"option",25),t._uU(45,"All"),t.qZA(),t.TgZ(46,"option",26),t._uU(47,"Linked to me"),t.qZA()()()()(),t.TgZ(48,"div",11)(49,"div",12)(50,"div",14)(51,"label",27),t._uU(52," Name (optional) "),t.qZA(),t._UZ(53,"input",28),t.qZA()(),t.TgZ(54,"div",29),t._UZ(55,"label",30),t.TgZ(56,"button",31),t._uU(57," Filter "),t.qZA()()()()()()()(),t.TgZ(58,"div",11)(59,"div",32),t.YNc(60,st,18,16,"div",33),t.qZA()(),t.YNc(61,ot,40,4,"ng-template",null,34,t.W1O)(63,rt,24,2,"ng-template",null,35,t.W1O)(65,at,18,1,"ng-template",null,36,t.W1O),t._UZ(67,"app-pop-up",37),t.qZA()()),2&n&&(t.xp6(5),t.Q6J("ngIf",s.show),t.xp6(5),t.Q6J("formGroup",s.searchForm),t.xp6(7),t.Q6J("ngClass",t.VKq(14,k,s.submitted&&s.f.gradeId.errors)),t.xp6(3),t.Q6J("ngForOf",s.grades),t.xp6(5),t.Q6J("ngClass",t.VKq(16,k,s.submitted&&s.f.subjectId.errors)),t.xp6(3),t.Q6J("ngForOf",s.subjects),t.xp6(),t.Q6J("ngIf",s.submitted&&s.f.subjectId.errors),t.xp6(6),t.Q6J("ngClass",t.VKq(18,k,s.submitted&&s.f.testId.errors)),t.xp6(3),t.Q6J("ngForOf",s.tests),t.xp6(18),t.Q6J("disabled",s.onload),t.xp6(4),t.Q6J("ngForOf",s.liveMonitoringCanidateList),t.xp6(7),t.s9C("content",s.message),t.s9C("title",s.title),t.s9C("show",s.showModal))},dependencies:[f.mk,f.sg,f.O5,o._Y,o.YN,o.Kr,o.Fj,o.EJ,o.JJ,o.JL,o.sg,o.u,A.s,f.uU],styles:["#irregularities.width[_ngcontent-%COMP%]{height:auto;transition:width .35s ease}.irregularity-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px}.irregularity-item[_ngcontent-%COMP%]{margin:10px;padding-left:5px}.float-left[_ngcontent-%COMP%]{float:left;width:21%;margin-left:30px}.yellow[_ngcontent-%COMP%]{background-color:#f57f17}.pink[_ngcontent-%COMP%]{color:#000;background-color:pink}#testChatMessageArea[_ngcontent-%COMP%]{text-align:left;margin:0 auto 25px;padding:10px;background:#fff;height:300px;width:530px;border:1px solid #a7a7a7;overflow:auto;border-radius:4px;border-bottom:4px solid #a7a7a7}#usermsg[_ngcontent-%COMP%]{flex:1;border-radius:4px;border:1px solid #ff9800}.msgln[_ngcontent-%COMP%]{margin:0 0 5px}.msgln[_ngcontent-%COMP%]   span.left-info[_ngcontent-%COMP%]{color:#ff4500}.msgln[_ngcontent-%COMP%]   span.chat-time[_ngcontent-%COMP%]{color:#666;font-size:60%;vertical-align:super}.msgln[_ngcontent-%COMP%]   b.user-name[_ngcontent-%COMP%], .msgln[_ngcontent-%COMP%]   b.user-name-left[_ngcontent-%COMP%]{font-weight:700;background:#546e7a;color:#fff;padding:2px 4px;font-size:90%;border-radius:4px;margin:0 5px 0 0}.msgln[_ngcontent-%COMP%]   b.user-name-left[_ngcontent-%COMP%]{background:#ff4500}.chat-wrapper[_ngcontent-%COMP%]{width:100%}.message-text[_ngcontent-%COMP%]{min-height:1em;max-height:97px;width:100%;align-content:center;outline:none;overflow:hidden}.message-wrapper[_ngcontent-%COMP%]{width:387px;border:1px solid #e4e7ec;border-radius:20px;background-color:#f9fafb;padding:24px;max-height:145px}textarea[_ngcontent-%COMP%]{resize:none;box-sizing:border-box;height:auto;min-height:41px;max-height:97px;width:auto;border:1px solid #e4e7ec;border-radius:20px;background-color:#f9fafb;outline:none;padding:0 24px;overflow:hidden;display:block;margin:0 auto}"]})}return i})()}];let lt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(dt),_.Bz]})}return i})();var y=l(60721);let ct=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({providers:[f.uU],imports:[f.ez,o.u5,o.UX,lt,(0,y.hX)(()=>(0,y.ZF)(b.N.firebaseConfig)),(0,m.Cm)(()=>(0,m.ad)()),A.s]})}return i})()}}]);